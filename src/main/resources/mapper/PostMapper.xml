<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.repository.PostRepository">

    <select id="getPostsById" parameterType="Long" resultType="org.example.domain.posts.Post">
        SELECT P.id, title, content, U.name as author
        FROM POST P
        LEFT JOIN USER U
        on U.id = P.user_id
        WHERE P.id = #{id};
    </select>

    <insert id="create" parameterType="org.example.domain.posts.Post">
        SET @u_id = 0;
        SELECT id into @u_id FROM USER WHERE name = #{author};

        INSERT INTO POST
            (title, content, user_id)
        VALUES (#{title}, #{content}, @u_id)
    </insert>

    <delete id="delete" parameterType="org.example.domain.posts.Post">
        DELETE FROM POST
        WHERE id = #{id}
    </delete>

    <update id="update" parameterType="org.example.domain.posts.Post">
        UPDATE POST
        SET title = #{title},
            content = #{content}
        WHERE id = #{id}
    </update>

</mapper>
